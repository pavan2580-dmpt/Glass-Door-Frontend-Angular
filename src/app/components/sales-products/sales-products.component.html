<div class="container shadow-sm rounded p-0 w-full">
  <app-header></app-header>
  <div class="row product-list-sec">
    <div class="col-md-6">
      <h4 class="mb-0">
        Products -
        <span class="count">({{ totalItems ? totalItems : "0" }})</span>
      </h4>
    </div>
    <div class="col-md-6 d-flex justify-content-end">
      <input
        class="form-control search text-capitalize"
        placeholder="Search Product Name..."
        type="text"
        [(ngModel)]="searchTerm"
        (keyup)="onSearch()"
      />
      <button (click)="open(content)" class="btn btn-primary">Add</button>
    </div>
  </div>
  <div class="table-container">
    <table class="table mb-0">
      <thead class="fixed-header">
        <tr>
          <th>S.No.</th>
          <th class="w-80">Product Name</th>
          <th>Price</th>
          <th>Date</th>
          <th class="w-14">Action</th>
        </tr>
      </thead>
      <tbody class="scrollable-tbody">
        @for(list of productData; ;let i=$index;track list){
        <tr>
          <td>{{ i + 1 }}</td>
          <td class="w-80">{{ list.name }}</td>
          <td class="price">{{ list.price | currency : "INR" }}</td>
          <td class="date">{{ list.updatedAt | date : "mediumDate" }}</td>
          <td class="w-14">
            <div class="btns">
              <button (click)="open(content, list)" class="btn text-primary">
                <i class="fa fa-pencil" aria-hidden="true"></i>
              </button>
              <!-- <button (click)="deleteProduct(list._id)" class="btn text-danger">
                <i class="fa fa-trash" aria-hidden="true"></i>
              </button> -->
            </div>
          </td>
        </tr>
        } @if(productData.length === 0){
        <tr>
          <td colspan="5" class="text-center">No data found...!</td>
        </tr>
        }
      </tbody>
    </table>
  </div>
  @if(productData.length){
  <div class="page_nation">
    <p>Showing {{ currentPage }} of {{ totalItems }} entries</p>
    <ngb-pagination
      [collectionSize]="totalItems"
      [(page)]="currentPage"
      [pageSize]="itemsPerPage"
      (pageChange)="onPageChange($event)"
    >
    </ngb-pagination>
  </div>
  }
</div>

<ng-template #content let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">
      {{ modifyData ? "Update Product" : "Add Product" }}
    </h4>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click'); purchaseData = []"
    ></button>
  </div>
  <div class="modal-body">
    @if(error){
    <div class="error alert alert-danger">
      {{ error }}
    </div>
    }
    <form [formGroup]="productForm">
      <div class="form-group">
        <label for="">Name</label>
        <input
          [formControlName]="'name'"
          type="text"
          name=""
          class="form-control text-capitalize"
          (input)="onInputChange()"
          [attr.readonly]="modifyData ? true : null"
        />
        @if (searchName && purchaseData.length) {
        <div class="dropdown">
          <ul>
            @for(product of purchaseData; track product){
            <li (click)="onProductSelect(product)">
              {{ product.productName }}
            </li>
            } @if(purchaseData.length === 0){
            <li class="text-center">No data found...!</li>
            }
          </ul>
        </div>
        }
      </div>
      <div class="form-group">
        <label for=""
          >Price @if(productPrice){ <b>(Actual Price :
          {{ productPrice | currency : "INR" }}) </b>}
        </label>
        <input
          [formControlName]="'price'"
          type="text"
          name=""
          class="form-control"
          min="1"
          step="1"
          (keypress)="validateNumber($event)"
        />
      </div>
    </form>
  </div>
  <div class="modal-footer">
    <button (click)="onSubmit()" type="button" class="btn btn-primary w-100">
      Save
    </button>
  </div>
</ng-template>
